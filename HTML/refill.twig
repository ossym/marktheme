{% set rawStatus = status|default('all') %}
{% set currentStatus = rawStatus|lower %}
{% set statusTabs = [
  {
    'key': 'all',
    'label': lang('refill.all'),
    'active_classes': 'bg-gradient-to-r from-primary-500 to-primary-600 text-white border-primary-500 shadow-md dark:from-primary-500 dark:to-primary-600',
    'inactive_classes': 'bg-primary-50 dark:bg-primary-900/20 text-primary-700 dark:text-primary-300 border-primary-300 dark:border-primary-600 hover:bg-primary-100 dark:hover:bg-primary-900/30'
  },
  {
    'key': 'pending',
    'label': lang('refill.status.pending'),
    'active_classes': 'bg-yellow-500 dark:bg-yellow-600 text-white border-yellow-500 dark:border-yellow-600 shadow-md',
    'inactive_classes': 'bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300 border-yellow-300 dark:border-yellow-600 hover:bg-yellow-100 dark:hover:bg-yellow-900/30'
  },
  {
    'key': 'inprogress',
    'label': lang('refill.status.inprogress'),
    'active_classes': 'bg-blue-500 dark:bg-blue-600 text-white border-blue-500 dark:border-blue-600 shadow-md',
    'inactive_classes': 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 border-blue-300 dark:border-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/30'
  },
  {
    'key': 'completed',
    'label': lang('refill.status.completed'),
    'active_classes': 'bg-green-500 dark:bg-green-600 text-white border-green-500 dark:border-green-600 shadow-md',
    'inactive_classes': 'bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border-green-300 dark:border-green-600 hover:bg-green-100 dark:hover:bg-green-900/30'
  },
  {
    'key': 'rejected',
    'label': lang('refill.status.rejected'),
    'active_classes': 'bg-red-500 dark:bg-red-600 text-white border-red-500 dark:border-red-600 shadow-md',
    'inactive_classes': 'bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border-red-300 dark:border-red-600 hover:bg-red-100 dark:hover:bg-red-900/30'
  },
  {
    'key': 'error',
    'label': lang('refill.status.error'),
    'active_classes': 'bg-red-500 dark:bg-red-600 text-white border-red-500 dark:border-red-600 shadow-md',
    'inactive_classes': 'bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 border-red-300 dark:border-red-600 hover:bg-red-100 dark:hover:bg-red-900/30'
  }
] %}
{% set statusBadgeClasses = {
  'pending': 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-700',
  'inprogress': 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 border-blue-200 dark:border-blue-700',
  'completed': 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border-green-200 dark:border-green-700',
  'rejected': 'bg-rose-100 dark:bg-rose-900/30 text-rose-800 dark:text-rose-300 border-rose-200 dark:border-rose-700',
  'error': 'bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 border-red-200 dark:border-red-700'
} %}

<main class="page-wrapper shrink grow bg-gray-50 dark:bg-dark transition-colors duration-300">
  <div class="mx-auto w-full max-w-full space-y-6 px-4 py-6 sm:px-6 lg:px-8">
    <section class="bg-white dark:bg-dark-secondary p-5 sm:p-6 rounded-xl shadow-sm dark:shadow-xl border border-gray-200 dark:border-dark-tertiary mb-6 transition-all duration-300">
      <div class="flex flex-col gap-6">
        <form action="{{ page['url'] }}" method="get" id="history-search"
              class="flex flex-col gap-3 md:flex-row md:items-center">
          <div class="relative flex-1">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input type="text" name="search" value="{{ search }}"
                   placeholder="{{ lang('general.search.placeholder') }}"
                   class="block w-full pl-10 pr-10 py-2.5 border border-gray-300 dark:border-dark-tertiary rounded-lg bg-white dark:bg-dark-tertiary text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00BFF3] dark:focus:ring-[#00BFF3] focus:border-transparent transition-all duration-200" />
            <button type="button" class="search-clear absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors {{ search ? '' : 'hidden' }}" aria-label="{{ lang('general.search.clear')|default('Clear search') }}">
              <svg class="w-4 h-4" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 3l8 8m0-8l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
              </svg>
            </button>
          </div>
          <button type="submit"
                  class="inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-[#00BFF3] to-[#009EC9] hover:from-[#009EC9] hover:to-[#0085B0] px-6 py-2.5 text-sm font-semibold text-white shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#00BFF3] focus:ring-offset-2 dark:focus:ring-offset-dark-secondary transition-all duration-200">
            {{ 'Search' }}
          </button>
        </form>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
          {% for tab in statusTabs %}
            {% set tabKey = tab.key %}
            {% set isActive = currentStatus == tabKey %}
            {% set tabUrl = tabKey == 'all' ? page['url'] : page['url'] ~ '/' ~ tabKey %}
            {% if search %}
              {% set tabUrl = tabUrl ~ '?search=' ~ search|url_encode %}
            {% endif %}
            <a href="{{ tabUrl }}"
               class="order-tab-btn flex items-center justify-center px-4 py-2.5 rounded-lg border text-sm font-medium transition-all duration-200 {{ isActive ? tab.active_classes : tab.inactive_classes }}">
              {{ tab.label }}
            </a>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="dash_card bg-white dark:bg-dark-secondary rounded-xl shadow-sm dark:shadow-xl border border-gray-200 dark:border-dark-tertiary p-6 sm:p-8 space-y-6 transition-all duration-300">
      {% if refillList %}
        <div class="orders-table-wrapper relative">
          <div class="loading-overlay hidden absolute inset-0 bg-white/80 dark:bg-dark-secondary/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center rounded-xl" aria-hidden="true">
            <div class="spinner w-12 h-12 border-4 border-[#00BFF3] border-t-transparent rounded-full animate-spin mb-4"></div>
            <span class="loading-text text-gray-700 dark:text-gray-300 font-medium">Loadingâ€¦</span>
          </div>

          <div class="orders-mobile-list space-y-4 mb-6 lg:hidden" aria-live="polite">
            {% for refill in refillList %}
              {% set statusKey = (refill['status_key']|default(refill['status']|lower))|replace({' ': '', '-': '', '_': ''}) %}
              {% set badgeClass = statusBadgeClasses[statusKey]|default('bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700') %}
              <article class="order-card bg-white dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden" data-refill-id="{{ refill['id'] }}">
                <header class="order-card__header border-b border-gray-200 dark:border-dark-tertiary p-4 bg-gray-50 dark:bg-dark-secondary">
                  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <div class="flex items-center gap-3">
                      <div class="flex flex-col">
                        <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">{{ lang('refill.id') }}</span>
                        <span class="text-base font-bold text-gray-900 dark:text-gray-100 mt-1">{{ refill['id'] }}</span>
                      </div>
                    </div>
                    <div class="flex flex-col text-right">
                      <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">{{ lang('refill.date') }}</span>
                      <span class="text-sm text-gray-700 dark:text-gray-300 mt-1">{{ refill['date'] }}</span>
                    </div>
                  </div>
                </header>
                <div class="order-card__content p-4 space-y-4">
                  <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">{{ lang('refill.order_id') }}</span>
                    <div class="flex items-center gap-2">
                      <a href="{{ page_url('orders') }}?search={{ refill['order_id'] }}" class="text-[#00BFF3] dark:text-[#4dd0e1] hover:underline font-medium flex-1 truncate">{{ refill['order_id'] }}</a>
                      <button type="button" class="copy-btn flex-shrink-0 p-1.5 text-gray-500 dark:text-gray-400 hover:text-[#00BFF3] dark:hover:text-[#4dd0e1] hover:bg-gray-100 dark:hover:bg-dark-secondary rounded transition-all duration-200" data-copy-text="{{ refill['order_id'] }}" title="Copy Order ID" aria-label="Copy Order ID">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                          <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">{{ lang('refill.link') }}</span>
                    <div class="flex items-center gap-2">
                      <a href="{{ refill['link'] }}" target="_blank" rel="noopener" class="text-[#00BFF3] dark:text-[#4dd0e1] hover:underline text-sm flex-1 truncate break-all">{{ refill['link'] }}</a>
                      <button type="button" class="copy-btn flex-shrink-0 p-1.5 text-gray-500 dark:text-gray-400 hover:text-[#00BFF3] dark:hover:text-[#4dd0e1] hover:bg-gray-100 dark:hover:bg-dark-secondary rounded transition-all duration-200" data-copy-text="{{ refill['link'] }}" title="Copy Link" aria-label="Copy Link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                          <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="flex flex-col gap-2">
                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide">{{ lang('refill.service') }}</span>
                    <span class="text-sm text-gray-900 dark:text-gray-100 font-medium">{{ refill['service'] }}</span>
                  </div>
                </div>
                <footer class="order-card__footer border-t border-gray-200 dark:border-dark-tertiary p-4 bg-gray-50 dark:bg-dark-secondary">
                  <div class="flex items-center justify-end">
                    <span class="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold uppercase tracking-wide {{ badgeClass }}">
                      {{ refill['status'] }}
                    </span>
                  </div>
                </footer>
              </article>
            {% endfor %}
          </div>

          <div class="hidden lg:block overflow-x-auto">
            <table id="service-table" cellspacing="0" class="w-full border-collapse {% if site['rtl'] %} rtl-table {% endif %}">
              <thead>
                <tr class="bg-gray-50 dark:bg-dark-secondary border-b-2 border-gray-200 dark:border-dark-tertiary">
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10">{{ lang('refill.id') }}</th>
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10">{{ lang('refill.date') }}</th>
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10">{{ lang('refill.order_id') }}</th>
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10 min-w-[200px]">{{ lang('refill.link') }}</th>
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10">{{ lang('refill.service') }}</th>
                  <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wider sticky top-0 bg-gray-50 dark:bg-dark-secondary z-10">{{ lang('refill.status') }}</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-dark-tertiary divide-y divide-gray-200 dark:divide-dark-tertiary">
                {% for refill in refillList %}
                  {% set statusKey = (refill['status_key']|default(refill['status']|lower))|replace({' ': '', '-': '', '_': ''}) %}
                  {% set badgeClass = statusBadgeClasses[statusKey]|default('bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 border-slate-200 dark:border-slate-700') %}
                  <tr class="hover:bg-gray-50 dark:hover:bg-dark-secondary transition-colors duration-150">
                    <td class="px-4 py-3 whitespace-nowrap">
                      <div class="flex items-center gap-2">
                        <button type="button" class="copy-btn p-1 text-gray-500 dark:text-gray-400 hover:text-[#00BFF3] dark:hover:text-[#4dd0e1] hover:bg-gray-100 dark:hover:bg-dark-secondary rounded transition-all duration-200" data-copy-text="{{ refill['id'] }}" title="Copy ID" aria-label="Copy ID">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                          </svg>
                        </button>
                        <strong class="text-sm font-semibold text-gray-900 dark:text-gray-100">{{ refill['id'] }}</strong>
                      </div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ refill['date'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <div class="flex items-center gap-2">
                        <a href="{{ page_url('orders') }}?search={{ refill['order_id'] }}" class="text-sm text-[#00BFF3] dark:text-[#4dd0e1] hover:underline font-medium">{{ refill['order_id'] }}</a>
                        <button type="button" class="copy-btn p-1 text-gray-500 dark:text-gray-400 hover:text-[#00BFF3] dark:hover:text-[#4dd0e1] hover:bg-gray-100 dark:hover:bg-dark-secondary rounded transition-all duration-200" data-copy-text="{{ refill['order_id'] }}" title="Copy Order ID" aria-label="Copy Order ID">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                          </svg>
                        </button>
                      </div>
                    </td>
                    <td class="px-4 py-3">
                      <div class="flex items-center gap-2 max-w-md">
                        <a href="{{ refill['link'] }}" target="_blank" rel="noopener" class="text-sm text-[#00BFF3] dark:text-[#4dd0e1] hover:underline truncate">{{ refill['link'] }}</a>
                        <button type="button" class="copy-btn flex-shrink-0 p-1 text-gray-500 dark:text-gray-400 hover:text-[#00BFF3] dark:hover:text-[#4dd0e1] hover:bg-gray-100 dark:hover:bg-dark-secondary rounded transition-all duration-200" data-copy-text="{{ refill['link'] }}" title="Copy Link" aria-label="Copy Link">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                          </svg>
                        </button>
                      </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">{{ refill['service'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                      <span class="inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold uppercase tracking-wide {{ badgeClass }}">
                        {{ refill['status'] }}
                      </span>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        {% if pagination['count'] > 100 %}
          {% set params = '' %}
          {% if searchList %}
            {% set paramsList = [] %}
            {% for item in searchList %}
              {% set paramsList = paramsList | merge([item['name'] ~ '=' ~ item['value']]) %}
            {% endfor %}
            {% set params = '?' ~ paramsList|join('&') %}
          {% endif %}
          <section class="pagination flex flex-wrap items-center justify-center gap-2 sm:gap-3 pt-6 border-t border-gray-200 dark:border-dark-tertiary">
            {% if pagination['current'] != 1 %}
              <a href="{{ page['url'] }}/{{ rawStatus }}/{{ pagination['last'] }}{{ params }}"
                 class="carousel-prev flex h-10 w-10 sm:h-16 sm:w-16 items-center justify-center rounded-full border border-[#00BFF3] dark:border-[#00BFF3] bg-white dark:bg-dark-tertiary text-[#00BFF3] hover:bg-[#00BFF3] hover:text-white dark:hover:bg-[#00BFF3] dark:hover:text-white transition-all duration-200 shadow-sm hover:shadow-md">
                <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.3281 1.33398L1.66146 10.0007L10.3281 18.6673" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </a>
            {% endif %}

            {% set r, l = 3, 3 %}
            {% if pagination['current'] == 1 %}
              {% set r = 6 %}
            {% endif %}
            {% if pagination['current'] == 2 %}
              {% set r = 5 %}
            {% endif %}
            {% if pagination['current'] >= pagination['pages'] %}
              {% set l = 5 %}
            {% endif %}

            {% for i in 1..ceil(pagination['pages']) %}
              {% if i >= (pagination['current']-l) and i <= (pagination['current']+r) %}
                <a href="{{ page['url'] }}/{{ rawStatus }}/{{ i }}{{ params }}" 
                   class="page_num flex h-10 w-10 sm:h-12 sm:w-12 items-center justify-center rounded-lg border text-sm font-medium transition-all duration-200 {% if i == pagination['current'] %} bg-gradient-to-r from-[#00BFF3] to-[#009EC9] text-white border-[#00BFF3] shadow-md {% else %} bg-white dark:bg-dark-tertiary border-gray-300 dark:border-dark-tertiary text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-dark-secondary hover:border-[#00BFF3] dark:hover:border-[#00BFF3] {% endif %}">
                  {{ i }}
                </a>
              {% endif %}
            {% endfor %}

            {% if pagination['current'] < pagination['pages'] %}
              <a href="{{ page['url'] }}/{{ rawStatus }}/{{ pagination['next'] }}{{ params }}"
                 class="carousel-next flex h-10 w-10 sm:h-16 sm:w-16 items-center justify-center rounded-full border border-[#00BFF3] dark:border-[#00BFF3] bg-white dark:bg-dark-tertiary text-[#00BFF3] hover:bg-[#00BFF3] hover:text-white dark:hover:bg-[#00BFF3] dark:hover:text-white transition-all duration-200 shadow-sm hover:shadow-md">
                <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M1.67188 18.666L10.3385 9.99935L1.67188 1.33268" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </a>
            {% endif %}
          </section>
        {% endif %}
      {% else %}
        <div class="empty-state flex flex-col items-center space-y-6 sm:space-y-8 rounded-xl border-2 border-[#85E0F9] dark:border-[#00BFF3]/30 bg-gradient-to-br from-[#85E0F9]/10 to-white dark:from-[#00BFF3]/10 dark:to-dark-tertiary py-12 sm:py-16 px-6 text-center">
          <svg width="64" height="64" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-[#00BFF3] dark:text-[#4dd0e1]">
            <path d="M30 60C13.4314 60 0 46.5686 0 30C0 13.4314 13.4314 0 30 0C46.5686 0 60 13.4314 60 30C60 46.5686 46.5686 60 30 60ZM30 54C43.2548 54 54 43.2548 54 30C54 16.7452 43.2548 6 30 6C16.7452 6 6 16.7452 6 30C6 43.2548 16.7452 54 30 54ZM27 39H33V45H27V39ZM27 15H33V33H27V15Z" fill="currentColor" />
          </svg>
          <p class="max-w-md text-sm sm:text-base text-gray-700 dark:text-gray-300">
            You don't have any refill requests yet. Once you submit a refill, it will appear here for quick tracking.
          </p>
          <div class="flex flex-col sm:flex-row flex-wrap items-center justify-center gap-3 sm:gap-4">
            <a href="/neworder" class="px-6 py-3 bg-gradient-to-r from-[#00BFF3] to-[#009EC9] hover:from-[#009EC9] hover:to-[#0085B0] text-white font-semibold rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-[#00BFF3] focus:ring-offset-2 dark:focus:ring-offset-dark-secondary transition-all duration-200">
              {{ lang('neworder.button') }}
            </a>
            <a href="/orders" class="px-6 py-3 border-2 border-[#00BFF3] dark:border-[#00BFF3] text-[#00BFF3] dark:text-[#4dd0e1] font-semibold rounded-lg hover:bg-[#00BFF3] hover:text-white dark:hover:bg-[#00BFF3] dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-[#00BFF3] focus:ring-offset-2 dark:focus:ring-offset-dark-secondary transition-all duration-200">
              {{ lang('orders.title')|default('View orders') }}
            </a>
          </div>
        </div>
      {% endif %}
    </section>
  </div>
</main>

<script>
  (function () {
    const toast = document.getElementById('copy-toast');
    const searchForm = document.getElementById('history-search');
    const searchInput = searchForm?.querySelector('input[name="search"]');
    const searchClearBtn = searchForm?.querySelector('.search-clear');

    // Show/hide clear button based on input value
    const toggleClearButton = () => {
      if (searchClearBtn && searchInput) {
        if (searchInput.value.trim()) {
          searchClearBtn.classList.remove('hidden');
        } else {
          searchClearBtn.classList.add('hidden');
        }
      }
    };

    // Initialize clear button visibility
    if (searchInput) {
      toggleClearButton();
      searchInput.addEventListener('input', toggleClearButton);
    }

    // Clear search functionality
    if (searchClearBtn) {
      searchClearBtn.addEventListener('click', () => {
        if (searchInput) {
          searchInput.value = '';
          searchInput.focus();
          toggleClearButton();
          // Submit form to clear search results
          searchForm.submit();
        }
      });
    }

    const showToast = () => {
      if (!toast) {
        return;
      }
      toast.classList.remove('opacity-0');
      toast.classList.add('opacity-100');
      clearTimeout(toast.hideTimer);
      toast.hideTimer = setTimeout(() => {
        toast.classList.remove('opacity-100');
        toast.classList.add('opacity-0');
      }, 2000);
    };

    const fallbackCopy = (text) => {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.setAttribute('readonly', '');
      textarea.style.position = 'absolute';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
    };

    document.addEventListener('click', async (event) => {
      const button = event.target.closest('.copy-btn[data-copy-text]');
      if (!button) {
        return;
      }
      const text = button.getAttribute('data-copy-text');
      if (!text) {
        return;
      }

      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          fallbackCopy(text);
        }
        button.classList.add('copied');
        setTimeout(() => button.classList.remove('copied'), 1200);
        showToast();
      } catch (error) {
        console.error('Copy failed', error);
      }
    });
  })();
</script>

<div id="copy-toast" class="fixed top-10 right-5 z-[9999] rounded-lg bg-gray-800 dark:bg-gray-900 px-4 py-2.5 text-sm text-white shadow-xl border border-gray-700 dark:border-gray-600 opacity-0 transition-opacity duration-300">
  {{ 'Copied to clipboard!' }}
</div>
