<!DOCTYPE html>
<html lang="{{site['iso_lang_code']}}">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page['title'] }}</title>
    <meta name="keywords" content="{{ site['seo_key'] }}">
    <meta name="description" content="{{ site['seo_desc'] }}">

    {% if site['favicon'] %}
    <link rel="shortcut icon" type="image/ico" href="{{ site['favicon'] }}" />
    {% endif %}

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

    {{ site['custom_header'] }}

    {% for style in site['styles'] %}
        {% if loop.index0 == 0 %}
            {# First link - bootstrap.css - Guest mode only #}
            {% if not user['auth'] %}
                <link rel="stylesheet" type="text/css" href="{{ style['href'] }}">
            {% endif %}
        {% elseif loop.index0 == 1 %}
            {# Second link - style.css - Auth mode only #}
            {% if user['auth'] %}
                <link rel="stylesheet" type="text/css" href="{{ style['href'] }}">
            {% endif %}
        {% elseif  style['href'] == 'https://storage.perfectcdn.com/global/w1ak29btsbdhu8s0.css' %}
                <!-- No need to load this style already loaded by the theme -->
        {% else %}
            {# Other styles - load for both modes #}
            <link rel="stylesheet" type="text/css" href="{{ style['href'] }}">
        {% endif %}
	{% endfor %}

    <script>
        window.modules = {};
    </script>
</head>

<body class="bg-gray-50 {% if site['rtl'] %} rtl {% endif %}" id="theme-body">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[9999] focus:px-4 focus:py-2 focus:bg-primary-500 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
        Skip to main content
    </a>
    {% if user['auth'] %}
    <!-- Authenticated Mode: Sidebar + Header -->
    <div class="flex overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="hidden lg:flex lg:flex-shrink-0 lg:flex-col bg-white border-r border-gray-200 transition-all duration-300 ease-in-out {% if site['rtl'] %} border-l border-r-0 {% endif %}" data-sidebar-expanded="true">
            <div class="flex flex-col flex-grow pt-5 pb-4 overflow-y-auto">
                <!-- Logo -->
                <div class="flex items-center flex-shrink-0 px-6 mb-6 sidebar-logo-container">
                    <a href="{{ page_url('index') }}" class="flex items-center sidebar-logo">
                        {% if site['logo'] %}
                        <img src="{{ site['logo'] }}" alt="{{ site['name'] }}" title="{{ site['name'] }}" class="h-8 w-auto sidebar-logo-img">
                        {% else %}
                        <span class="text-xl font-bold text-primary-500 sidebar-logo-text">{{ site['name'] }}</span>
                        {% endif %}
                    </a>
                </div>

                <!-- New Order Button -->
                <div class="px-4 mb-4 sidebar-new-order-container">
                    <a href="{{ page_url('neworder') }}" class="flex items-center justify-center w-full px-4 py-3 text-sm font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-600 rounded-lg hover:from-primary-600 hover:to-primary-700 transition-all shadow-md hover:shadow-lg sidebar-new-order-btn">
                        <svg class="w-5 h-5 sidebar-new-order-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span class="sidebar-new-order-text ml-2">New Order</span>
                    </a>
                </div>

                <!-- Navigation Menu -->
                <nav class="flex-1 px-4 space-y-1 sidebar-nav">
                    {% for menu in site['menu'] %}
                        <a href="{{ menu['link'] }}" {% if menu['external'] %} target="_blank" {% endif %} class="flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors sidebar-nav-item {% if menu['active'] %} bg-primary-50 text-primary-500 dark:bg-primary-900/20 dark:text-primary-300 {% else %} text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-dark-tertiary hover:text-gray-900 dark:hover:text-slate-100 {% endif %}">
                            {% if menu['icon'] %}
                                <i class="{{ menu['icon'] }} w-5 h-5 mr-3 sidebar-nav-icon {% if menu['active'] %} text-primary-500 dark:text-primary-300 {% else %} text-gray-400 dark:text-slate-400 {% endif %}"></i>
                            {% else %}
                                <svg class="w-5 h-5 sidebar-nav-icon mr-3 text-gray-400 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            {% endif %}
                            <span class="sidebar-nav-text flex items-center gap-2">
                                {{ menu['name']|raw }}
                            </span>
                        </a>
                    {% endfor %}
                </nav>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40 lg:hidden hidden"></div>

        <!-- Mobile Sidebar -->
        <aside id="mobile-sidebar" class="fixed inset-y-0 z-50 w-sidebar-mobile bg-white transform transition-transform duration-300 ease-in-out lg:hidden {% if site['rtl'] %} right-0 -translate-x-full {% else %} left-0 -translate-x-full {% endif %}">
            <div class="flex flex-col h-full">
                <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
                    <a href="{{ page_url('index') }}" class="flex items-center">
                        {% if site['logo'] %}
                        <img src="{{ site['logo'] }}" alt="{{ site['name'] }}" class="h-8 w-auto">
                        {% else %}
                        <span class="text-xl font-bold text-primary-500">{{ site['name'] }}</span>
                        {% endif %}
                    </a>
                    <button id="close-sidebar" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100" aria-label="Close navigation menu">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="flex-1 overflow-y-auto py-4">
                    <div class="px-4 mb-4">
                        <a href="{{ page_url('neworder') }}" class="flex items-center justify-center w-full px-4 py-3 text-sm font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-600 rounded-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                            New Order
                        </a>
                    </div>
                    <nav class="px-4 space-y-1">
                        {% for menu in site['menu'] %}
                            <a href="{{ menu['link'] }}" {% if menu['external'] %} target="_blank" {% endif %} class="flex items-center px-3 py-2.5 text-sm font-medium rounded-lg {% if menu['active'] %} bg-primary-50 text-primary-500 dark:bg-primary-900/20 dark:text-primary-300 {% else %} text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-dark-tertiary hover:text-gray-900 dark:hover:text-slate-100 {% endif %}">
                                {% if menu['icon'] %}
                                <i class="{{ menu['icon'] }} w-5 h-5 mr-3 {% if menu['active'] %} dark:text-primary-300 {% else %} dark:text-slate-400 {% endif %}"></i>
                                {% endif %}
                                <span class="flex items-center gap-2">{{ menu['name']|raw }}</span>
                            </a>
                        {% endfor %}
                    </nav>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
                <div class="flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8">
                    <!-- Left: Sidebar Expand/Collapse + Menu Toggle (mobile) + Logo (mobile) -->
                    <div class="flex items-center">
                        <!-- Sidebar Expand/Collapse Button (Desktop) -->
                        <button id="sidebar-expand-toggle" class="hidden lg:flex p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 mr-2 transition-colors" title="Toggle Sidebar" aria-label="Toggle sidebar" aria-expanded="true" aria-controls="sidebar">
                            <svg id="sidebar-expand-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                            </svg>
                            <svg id="sidebar-collapse-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                            </svg>
                        </button>
                        <!-- Mobile Menu Toggle -->
                        <button id="sidebar-toggle" class="lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 mr-2" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobile-sidebar">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>

                    <!-- Right: Theme Toggle + Balance + User Info -->
                    <div class="flex items-center space-x-3 {% if site['rtl'] %} space-x-reverse {% endif %}">
                        <!-- Theme Toggle -->
                        <button id="theme-toggle" class="p-2 rounded-lg text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-colors" aria-label="Toggle dark mode" aria-pressed="false">
                            <svg id="theme-icon-sun" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                            </svg>
                            <svg id="theme-icon-moon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                            </svg>
                        </button>

                        <!-- Add Funds Button -->
                        <a href="{{ page_url('addfunds') }}" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-medium shadow-md hover:shadow-lg transition-all duration-200 dark:from-primary-500 dark:to-primary-600 dark:hover:from-primary-600 dark:hover:to-primary-700" title="Add Funds" aria-label="Add funds to account">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                            </svg>
                            <span class="hidden sm:inline">Add Funds</span>
                        </a>

                        <!-- Balance Dropdown -->
                        {% if site.currencies %}
                        <div class="relative dropdown dropdown-currencies">
                            <button class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 bg-gray-50 hover:bg-gray-100 transition-colors" data-toggle="dropdown" aria-label="Select currency" aria-expanded="false" aria-haspopup="true" aria-controls="currencies-list">
                                <span class="font-semibold text-primary-500">{{ user.balance_formatted }}</span>
                                <svg class="ml-1.5 h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <ul class="hidden absolute right-0 mt-2 w-48 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50 dropdown-menu" id="currencies-list">
                                {% for key, rate in site.currencies %}
                                <li>
                                    <a href="#" id="currencies-item" data-rate-key="{{ key }}" data-rate-symbol="{{ rate.symbol }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">{{ key }} {{ rate.symbol }}</a>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% else %}
                        <div class="px-3 py-2 text-sm font-medium text-gray-700">
                            <span class="font-semibold text-primary-500">{{ user.balance_formatted }}</span>
                        </div>
                        {% endif %}

                        <!-- User Menu -->
                        <div class="relative dropdown user-menu-dropdown">
                            <button class="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-tertiary transition-colors" data-toggle="dropdown" aria-label="User menu for {{ user.username }}" aria-expanded="false" aria-haspopup="true">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-sm" aria-hidden="true">
                                    {% if user.username and user.username[0] %}
                                        <span class="text-sm font-semibold text-white">{{ user.username[0]|upper }}</span>
                                    {% else %}
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    {% endif %}
                                </div>
                                <span class="hidden sm:block text-sm font-medium text-gray-700 dark:text-slate-100">{{ user.username }}</span>
                                <svg class="hidden sm:block h-4 w-4 text-gray-400 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <ul class="hidden absolute right-0 mt-2 w-56 rounded-lg shadow-lg bg-white dark:bg-dark-secondary ring-1 ring-black ring-opacity-5 dark:ring-gray-700 z-[100] dropdown-menu user-account-menu py-1">
                                <!-- Blog Menu Item -->
                                <li class="border-t border-gray-200 dark:border-gray-700 mt-1 pt-1">
                                    <a href="/blog" class="flex items-center px-4 py-2.5 text-sm text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-dark-tertiary transition-colors duration-150">
                                        <svg class="w-5 h-5 mr-3 text-gray-400 dark:text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                                        </svg>
                                        <span class="flex-1">Blog</span>
                                    </a>
                                </li>
                                <!-- Terms Menu Item -->
                                <li>
                                    <a href="/terms" class="flex items-center px-4 py-2.5 text-sm text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-dark-tertiary transition-colors duration-150">
                                        <svg class="w-5 h-5 mr-3 text-gray-400 dark:text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <span class="flex-1">Terms</span>
                                    </a>
                                </li>
                                {% for menu in site['account_menu'] %}
                                    {% if menu['link'] %}
                                        <li {% if menu['name']|lower == 'logout' %} class="border-t border-gray-200 dark:border-gray-700 mt-1 pt-1" {% endif %}>
                                            <a href="{{ menu['link'] }}" {% if menu['external'] %} target="_blank" {% endif %} class="flex items-center px-4 py-2.5 text-sm transition-colors duration-150 {% if menu['name']|lower == 'logout' %} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-700 dark:hover:text-red-300 {% else %} text-gray-700 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-dark-tertiary {% if menu['active'] %} bg-primary-50 dark:bg-primary-900/20 text-primary-500 dark:text-primary-400 {% endif %} {% endif %}">
                                                {% if menu['name']|lower == 'account' %}
                                                    <svg class="w-5 h-5 mr-3 text-gray-400 dark:text-slate-500 {% if menu['active'] %} text-primary-500 dark:text-primary-400 {% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                                    </svg>
                                                {% elseif menu['name']|lower == 'logout' %}
                                                    <svg class="w-5 h-5 mr-3 text-red-500 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                                    </svg>
                                                {% else %}
                                                    <svg class="w-5 h-5 mr-3 text-gray-400 dark:text-slate-500 {% if menu['active'] %} text-primary-500 dark:text-primary-400 {% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                                    </svg>
                                                {% endif %}
                                                <span class="flex-1">{{ menu['name'] }}</span>
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Auth Mode: Page Content -->
            <main id="main-content" class="flex-1 overflow-y-auto" role="main">
                <div class="auth-container py-6">
                    {{ content }}
                </div>
            </main>
        </div>
    </div>
    
    {% else %}
    <!-- Guest Mode: Header Only -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 {% if site['rtl'] %} rtl-navbar {% endif %}">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="{{ page_url('index') }}" class="flex items-center">
                        {% if site['logo'] %}
                        <img src="{{ site['logo'] }}" alt="{{ site['name'] }}" title="{{ site['name'] }}" class="h-8 w-auto">
                        {% else %}
                        <span class="text-xl font-bold text-primary-500">{{ site['name'] }}</span>
                        {% endif %}
                    </a>
                </div>

                <!-- Navigation Links -->
                <nav class="hidden md:flex items-center space-x-1 {% if site['rtl'] %} space-x-reverse {% endif %}">
                    {% for menu in site['menu'] %}
                    <a href="{{ menu['link'] }}" {% if menu['external'] %} target="_blank" {% endif %} class="px-4 py-2 text-sm font-medium rounded-lg transition-colors {% if menu['active'] %} bg-primary-50 text-primary-500 {% else %} text-gray-700 hover:text-gray-900 hover:bg-gray-100 {% endif %}">
                        {{ menu['name'] }}
                    </a>
                    {% endfor %}
                </nav>

                <!-- Right Side: Language + Theme + Auth Buttons -->
                <div class="flex items-center space-x-3 {% if site['rtl'] %} space-x-reverse {% endif %}">
                    <!-- Language Selector -->
                    {% if site['languages']|length > 1 %}
                    <div class="relative dropdown hidden md:block">
                        {% for lang in site['languages'] %}
                        {% if lang['active'] %}
                        <button class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-100 transition-colors" data-toggle="dropdown">
                            {{ lang['name'] }}
                            <svg class="ml-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        {% endif %}
                        {% endfor %}
                        <ul class="hidden absolute right-0 mt-2 w-48 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50 dropdown-menu">
                            {% for lang in site['languages'] %}
                            <li>
                                <a href="{{ lang['url'] }}" class="block px-4 py-2 text-sm {% if lang['active'] %} text-primary-500 bg-primary-50 font-medium {% else %} text-gray-700 hover:bg-gray-100 {% endif %}">{{ lang['name'] }}</a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Theme Toggle -->
                    <button id="theme-toggle" class="p-2 rounded-lg text-gray-400 hover:text-gray-500 hover:bg-gray-100 transition-colors" aria-label="Toggle dark mode" aria-pressed="false">
                        <svg id="theme-icon-sun" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <svg id="theme-icon-moon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>

                    <!-- Sign In Button -->
                    <a href="{{ page_url('signin') }}" class="hidden md:inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Sign In
                    </a>

                    <!-- Sign Up Button -->
                    <a href="{{ page_url('signup') }}" class="inline-flex items-center px-4 py-2 text-sm font-semibold text-white bg-primary-500 rounded-lg hover:bg-primary-600 transition-colors shadow-sm hover:shadow-md">
                        Sign Up
                    </a>

                    <!-- Mobile Menu Toggle -->
                    <button id="mobile-menu-toggle" class="md:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="mobile-menu">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-gray-200" role="menu" aria-label="Mobile navigation menu">
                <div class="pt-4 space-y-1">
                    {% for menu in site['menu'] %}
                    <a href="{{ menu['link'] }}" {% if menu['external'] %} target="_blank" {% endif %} class="block px-4 py-2 text-base font-medium {% if menu['active'] %} text-primary-500 bg-primary-50 {% else %} text-gray-700 hover:text-gray-900 hover:bg-gray-100 {% endif %}">
                        {{ menu['name'] }}
                    </a>
                    {% endfor %}
                    {% if site['languages']|length > 1 %}
                    <div class="pt-4 border-t border-gray-200">
                        <div class="px-4 py-2 text-sm font-medium text-gray-500">Language</div>
                        {% for lang in site['languages'] %}
                        <a href="{{ lang['url'] }}" class="block px-4 py-2 text-base font-medium {% if lang['active'] %} text-primary-500 bg-primary-50 {% else %} text-gray-700 hover:text-gray-900 hover:bg-gray-100 {% endif %}">{{ lang['name'] }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="pt-4 border-t border-gray-200 px-4 space-y-2">
                        <a href="{{ page_url('signin') }}" class="block w-full text-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                            Sign In
                        </a>
                        <a href="{{ page_url('signup') }}" class="block w-full text-center px-4 py-2 text-sm font-semibold text-white bg-primary-500 rounded-lg hover:bg-primary-600">
                            Sign Up
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Guest Content -->
    <main id="main-content" class="min-h-screen" role="main">
        {{ content }}
    </main>

    <!-- Footer (Guest Mode Only) -->
    <footer class="bg-white dark:bg-dark-secondary border-t border-gray-200 dark:border-dark-tertiary mt-auto transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-12">
                <!-- Left Section: Logo -->
                <div class="flex flex-col items-center md:items-start">
                    <a href="{{ page_url('index') }}" class="flex items-center mb-4">
                        {% if site['logo'] %}
                        <img src="{{ site['logo'] }}" alt="{{ site['name'] }}" title="{{ site['name'] }}" class="h-10 w-auto">
                        {% else %}
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-accent-500 rounded-lg flex items-center justify-center mr-3">
                                <span class="text-white font-bold text-xl">M</span>
                            </div>
                            <span class="text-xl font-bold text-gray-900 dark:text-slate-100">{{ site['name'] }}</span>
                        </div>
                        {% endif %}
                    </a>
                </div>

                <!-- Middle Section: Menu -->
                <div>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Menu</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="{{ page_url('/') }}" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Home</a>
                        <a href="{{ page_url('terms') }}" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Terms</a>
                        <a href="{{ page_url('services') }}" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Services</a>
                        <a href="/privacy-policy" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Privacy policy</a>
                        <a href="{{ page_url('blog') }}" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Blog</a>
                        <a href="/contact-us" class="text-gray-600 dark:text-slate-300 hover:text-primary-500 dark:hover:text-primary-400 transition-colors duration-200">Contact</a>
                    </div>
                </div>

                <!-- Right Section: Follow Us -->
                <div>
                    <h3 class="text-lg font-bold text-gray-900 dark:text-slate-100 mb-4">Follow us</h3>
                    <div class="flex flex-wrap gap-3">
                        <!-- Telegram -->
                        <a href="#" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="Telegram" aria-label="Follow us on Telegram">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                            </svg>
                        </a>
                        <!-- WhatsApp -->
                        <a href="https://wa.me/447868724202" target="_blank" rel="noopener noreferrer" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="WhatsApp" aria-label="Contact us on WhatsApp">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.369 1.262.589 1.694.755.712.27 1.36.232 1.871.141.574-.099 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                            </svg>
                        </a>
                        <!-- X (Twitter) -->
                        <a href="#" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="X (Twitter)" aria-label="Follow us on X (formerly Twitter)">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <!-- Skype -->
                        <a href="#" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="Skype" aria-label="Contact us on Skype">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12.04 0C5.408-.02.004 5.37.004 12.017c0 3.63 1.94 6.818 4.84 8.58l-.64 2.38 2.56-.67c.72.2 1.48.32 2.28.32 6.624 0 11.996-5.4 11.996-12.05C22.036 5.37 16.664.02 12.04 0zm5.84 15.19c-.16.45-.92.84-1.28 1.01-.36.17-.72.26-1.6.53-.88.26-2.04.4-2.96.4-2.48 0-4.4-.8-5.84-2.24-1.44-1.44-2.24-3.36-2.24-5.84 0-.92.13-2.08.4-2.96.13-.44.36-1.2.53-1.6.17-.36.56-1.12 1.01-1.28.45-.16.92-.08 1.2.08.28.16 1.84 1.2 2.08 1.44.24.24.4.52.24.88-.16.36-.24.6-.4.88-.16.28-.32.4-.56.64-.24.24-.52.52-.24.88.28.36 1.12 1.44 2.4 2.32 1.28.88 2.36 1.16 2.72 1.28.36.12.6.04.88-.12.28-.16 1.2-.72 1.52-.96.32-.24.56-.16.88.08.32.24 2.08 1.96 2.44 2.32.36.36.6.52.72.88.12.36.04.6-.08.88z"/>
                            </svg>
                        </a>
                        <!-- YouTube -->
                        <a href="#" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="YouTube" aria-label="Subscribe to our YouTube channel">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </a>
                        <!-- Medium -->
                        <a href="#" class="w-10 h-10 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-500/30 rounded-lg flex items-center justify-center text-primary-500 dark:text-primary-400 hover:bg-primary-100 dark:hover:bg-primary-900/40 hover:border-primary-300 dark:hover:border-primary-500/50 transition-all duration-200" title="Medium" aria-label="Follow us on Medium">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Bottom Footer Bar -->
            <div class="mt-8 pt-8 border-t border-primary-200 dark:border-primary-500/30 flex flex-col sm:flex-row items-center justify-between gap-4 transition-colors duration-300">
                <!-- Disclaimer -->
                <p class="text-sm text-gray-500 dark:text-slate-400 text-center sm:text-left">
                    Marketerum is not directly related to any Social Media platform.
                </p>
                <!-- Copyright -->
                <p class="text-sm text-gray-500 dark:text-slate-400 text-center sm:text-right">
                    Marketerum Copyright Â© 2025 - All rights Reserved
                </p>
            </div>
        </div>
    </footer>
    {% endif %}

    <!-- Bonus Offer Popup -->
    <div class="modal fade" id="bonusPopup" data-expires="2025-12-30T00:00" data-status="false" data-percent="5" tabindex="-1" role="dialog" aria-labelledby="bonusTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered max-w-md" role="document">
            <div class="modal-content bg-white dark:bg-dark-secondary rounded-xl shadow-2xl border border-gray-200 dark:border-dark-tertiary overflow-hidden relative">
                <button type="button" class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-full text-white hover:text-white transition-all duration-200 shadow-lg hover:shadow-xl" id="bonusCloseBtn" data-dismiss="modal" aria-label="Close">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div class="bg-gradient-to-br from-primary-500 to-primary-600 px-6 py-8 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"></div>
                    <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"></div>
                    <div class="relative z-10">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-white/20 rounded-full mb-4 backdrop-blur-sm">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
                            </svg>
                        </div>
                        <h4 class="text-2xl font-bold text-white mb-2" id="bonusTitle">
                            Special Offer
                            <span class="block text-3xl mt-1" id="bonusPercent">40%</span>
                        </h4>
                        <p class="text-primary-100 text-sm">Get extra credits on your payment!</p>
                    </div>
                </div>
                <div class="px-6 py-6">
                    <p class="text-gray-700 dark:text-slate-300 text-center mb-6">
                        ðŸŽ‰ Exclusive bonus offer! This amazing deal won't last long.
                    </p>
                    <div class="space-y-3 mb-6">
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary">
                            <span class="text-gray-700 dark:text-slate-300 font-medium">Add $10</span>
                            <span class="text-primary-600 dark:text-primary-400 font-semibold">+ $4.00 bonus</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary">
                            <span class="text-gray-700 dark:text-slate-300 font-medium">Add $50</span>
                            <span class="text-primary-600 dark:text-primary-400 font-semibold">+ $20.00 bonus</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary">
                            <span class="text-gray-700 dark:text-slate-300 font-medium">Add $100</span>
                            <span class="text-primary-600 dark:text-primary-400 font-semibold">+ $40 bonus</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary">
                            <span class="text-gray-700 dark:text-slate-300 font-medium">Add $500</span>
                            <span class="text-primary-600 dark:text-primary-400 font-semibold">+ $200 bonus</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-dark-tertiary rounded-lg border border-gray-200 dark:border-dark-tertiary">
                            <span class="text-gray-700 dark:text-slate-300 font-medium">Add $1000</span>
                            <span class="text-primary-600 dark:text-primary-400 font-semibold">+ $400 bonus</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-slate-400 text-center mb-6">
                        Offer valid until <span class="font-semibold text-gray-700 dark:text-slate-300" id="bonusExpiration">30 November 2025 at 00:00</span>
                    </p>
                    <a href="/addfunds" class="block w-full text-center px-6 py-3 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200" id="bonusClaimBtn">
                        Claim Your Bonus
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if user['auth'] %}
        <!-- Balance Info Modal -->
        <div class="modal fade" id="balancePopup" tabindex="-1" role="dialog" aria-labelledby="balancePopupTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered max-w-md" role="document">
                <div class="modal-content bg-white dark:bg-dark-secondary rounded-xl shadow-2xl border border-gray-200 dark:border-dark-tertiary overflow-hidden relative">
                    <button type="button" class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 dark:bg-dark-tertiary dark:hover:bg-gray-700 rounded-full text-gray-600 hover:text-gray-800 dark:text-slate-300 dark:hover:text-slate-100 transition-all duration-200 shadow-md hover:shadow-lg" id="balanceCloseBtn" data-dismiss="modal" aria-label="Close">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div class="px-6 py-8 text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full mb-4">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <h4 id="balancePopupTitle" class="text-2xl font-bold text-gray-900 dark:text-slate-100 mb-3">ðŸŽ‰ Welcome to Marketerum</h4>
                        <div class="mb-4">
                            <p class="text-gray-600 dark:text-slate-400 mb-2">Your current balance is</p>
                            <p class="text-3xl font-bold text-primary-600 dark:text-primary-400">{{ user.balance_formatted }}</p>
                        </div>
                        <p class="text-gray-700 dark:text-slate-300 mb-6">Add funds to start boosting your social media presence and grow your accounts.</p>
                        <a href="/addfunds" class="block w-full text-center px-6 py-3 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200 mb-3" id="balanceAddFundsBtn">
                            <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                            Add Funds &amp; Start Growing
                        </a>
                        <small class="text-gray-500 dark:text-slate-400 text-sm">Minimum deposit is just $1</small>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Notifications wrapper -->
    <div id="notify-wrapper" class="fixed top-4 right-4 z-50 max-w-sm w-full bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 hidden" style="display: none;" role="alert">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3 flex-1">
                <p class="text-sm font-medium text-green-800"></p>
            </div>
            <div class="ml-auto pl-3">
                <button type="button" class="inline-flex text-green-400 hover:text-green-600 focus:outline-none" onclick="this.parentElement.parentElement.parentElement.style.display='none'">
                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-[110px] left-[20px] z-50 flex flex-col gap-4">
        <!-- Scroll to Top Button -->
        <button id="scroll-to-top" class="w-[55px] h-[55px] bg-primary-500 text-white rounded-full shadow-lg hover:bg-primary-600 transition-all hover:shadow-xl flex items-center justify-center hidden" aria-label="Scroll to top">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
            </svg>
        </button>
        <!-- WhatsApp Button -->
      <!--   <a href="https://wa.me/447868724202" target="_blank" rel="noopener noreferrer" class="w-12 h-12 bg-accent-500 text-white rounded-full shadow-lg hover:bg-accent-600 transition-all hover:shadow-xl flex items-center justify-center" title="WhatsApp" aria-label="Contact us on WhatsApp">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.369 1.262.589 1.694.755.712.27 1.36.232 1.871.141.574-.099 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
            </svg>
        </a>-->
    </div>

    {{ site['custom_footer'] }}

	{% for script in site['scripts'] %}
		<script type="text/javascript" {% if script['src'] %} src="{{ script['src'] }}" {% endif %}>
			{% if script['code'] %}
                {{ script['code'] }}
            {% endif %}
		</script>
	{% endfor %}

    <!-- Modals Control Scripts -->
    <script>
    (function() {
        'use strict';

        // ============================================
        // Balance Modal Control
        // ============================================
        {% if user['auth'] %}
        const BalanceModal = {
            STORAGE_KEY: 'balanceModalClosed',
            HOUR_DELAY: 1, // 1 hour
            MIN_BALANCE: 1, // $1 minimum

            init: function() {
                const modal = document.getElementById('balancePopup');
                if (!modal) return;

                // Check if modal was closed recently
                if (this.wasClosedRecently()) {
                    return;
                }

                // Check user balance
                const balanceText = '{{ user.balance_formatted }}';
                const balanceValue = this.parseBalance(balanceText);

                // Show modal only if balance is less than $1
                if (balanceValue < this.MIN_BALANCE) {
                    // Small delay to ensure page is loaded and jQuery is ready
                    setTimeout(() => {
                        if (typeof $ !== 'undefined' && $.fn.modal) {
                            $(modal).modal({
                                backdrop: true,
                                keyboard: true,
                                show: true
                            });
                        }
                    }, 500);
                }

                // Handle close button
                const closeBtn = document.getElementById('balanceCloseBtn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        this.saveCloseTime();
                    });
                }

                // Handle Add Funds button - save time and navigate to /addfunds
                const addFundsBtn = document.getElementById('balanceAddFundsBtn');
                if (addFundsBtn) {
                    addFundsBtn.addEventListener('click', () => {
                        this.saveCloseTime();
                    });
                }

                // Handle modal backdrop click
                $(modal).on('hidden.bs.modal', () => {
                    this.saveCloseTime();
                });
            },

            parseBalance: function(balanceText) {
                // Extract numeric value from balance string (e.g., "$10.50" -> 10.50)
                const match = balanceText.match(/[\d.]+/);
                return match ? parseFloat(match[0]) : 0;
            },

            wasClosedRecently: function() {
                const closedTime = localStorage.getItem(this.STORAGE_KEY);
                if (!closedTime) return false;

                const now = new Date().getTime();
                const closed = parseInt(closedTime, 10);
                const hoursPassed = (now - closed) / (1000 * 60 * 60);

                return hoursPassed < this.HOUR_DELAY;
            },

            saveCloseTime: function() {
                localStorage.setItem(this.STORAGE_KEY, new Date().getTime().toString());
            }
        };

        // Initialize Balance Modal when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => BalanceModal.init());
        } else {
            BalanceModal.init();
        }
        {% endif %}

        // ============================================
        // Bonus Modal Control
        // ============================================
        const BonusModal = {
            STORAGE_KEY: 'bonusModalClosed',
            HOUR_DELAY: 1, // 1 hour

            init: function() {
                const modal = document.getElementById('bonusPopup');
                if (!modal) return;

                // Check if modal was closed recently
                if (this.wasClosedRecently()) {
                    return;
                }

                // Check if bonus is active (data-status="true")
                const isActive = modal.getAttribute('data-status') === 'true';
                if (!isActive) {
                    return;
                }

                // Check expiration date
                const expiresDate = modal.getAttribute('data-expires');
                if (expiresDate && this.isExpired(expiresDate)) {
                    return;
                }

                // Update bonus percentage and calculate tiers
                this.updateBonusContent(modal);

                // Show modal with delay
                setTimeout(() => {
                    if (typeof $ !== 'undefined' && $.fn.modal) {
                        $(modal).modal({
                            backdrop: true,
                            keyboard: true,
                            show: true
                        });
                    }
                }, 1000);

                // Handle close button
                const closeBtn = document.getElementById('bonusCloseBtn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        this.saveCloseTime();
                    });
                }

                // Handle modal backdrop click
                $(modal).on('hidden.bs.modal', () => {
                    this.saveCloseTime();
                });
            },

            isExpired: function(expiresDate) {
                const expiration = new Date(expiresDate);
                const now = new Date();
                return now > expiration;
            },

            wasClosedRecently: function() {
                const closedTime = localStorage.getItem(this.STORAGE_KEY);
                if (!closedTime) return false;

                const now = new Date().getTime();
                const closed = parseInt(closedTime, 10);
                const hoursPassed = (now - closed) / (1000 * 60 * 60);

                return hoursPassed < this.HOUR_DELAY;
            },

            saveCloseTime: function() {
                localStorage.setItem(this.STORAGE_KEY, new Date().getTime().toString());
            },

            updateBonusContent: function(modal) {
                // Get bonus percentage from data attribute
                const percent = modal.getAttribute('data-percent') || '40';
                const percentNum = parseInt(percent, 10);

                // Update percentage display
                const percentElement = document.getElementById('bonusPercent');
                if (percentElement) {
                    percentElement.textContent = percent + '%';
                }

                // Update expiration date display
                const expiresDate = modal.getAttribute('data-expires');
                if (expiresDate) {
                    const expiration = new Date(expiresDate);
                    const expirationElement = document.getElementById('bonusExpiration');
                    if (expirationElement) {
                        expirationElement.textContent = this.formatDate(expiration);
                    }
                }

                // Calculate and update bonus tiers
                const tiers = [
                    { amount: 10, bonus: (10 * percentNum / 100).toFixed(2) },
                    { amount: 50, bonus: (50 * percentNum / 100).toFixed(2) },
                    { amount: 100, bonus: (100 * percentNum / 100).toFixed(0) },
                    { amount: 500, bonus: (500 * percentNum / 100).toFixed(0) },
                    { amount: 1000, bonus: (1000 * percentNum / 100).toFixed(0) }
                ];

                const tierItems = modal.querySelectorAll('.flex.items-center.justify-between');
                tierItems.forEach((item, index) => {
                    if (tiers[index]) {
                        const amountSpan = item.querySelector('span:first-child');
                        const bonusSpan = item.querySelector('span:last-child');
                        if (amountSpan) {
                            amountSpan.textContent = `Add $${tiers[index].amount}`;
                        }
                        if (bonusSpan) {
                            bonusSpan.textContent = `+ $${tiers[index].bonus} bonus`;
                        }
                    }
                });
            },

            formatDate: function(date) {
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
                const day = date.getDate();
                const month = months[date.getMonth()];
                const year = date.getFullYear();
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${day} ${month} ${year} at ${hours}:${minutes}`;
            },

            // Public method to show modal programmatically
            show: function(percent, expiresDate, status) {
                const modal = document.getElementById('bonusPopup');
                if (!modal) return;

                if (percent) modal.setAttribute('data-percent', percent);
                if (expiresDate) modal.setAttribute('data-expires', expiresDate);
                if (status !== undefined) modal.setAttribute('data-status', status.toString());

                this.updateBonusContent(modal);
                if (typeof $ !== 'undefined' && $.fn.modal) {
                    $(modal).modal({
                        backdrop: true,
                        keyboard: true,
                        show: true
                    });
                }
            },

            // Public method to hide modal programmatically
            hide: function() {
                const modal = document.getElementById('bonusPopup');
                if (modal && typeof $ !== 'undefined' && $.fn.modal) {
                    $(modal).modal('hide');
                }
            }
        };

        // Initialize Bonus Modal when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => BonusModal.init());
        } else {
            BonusModal.init();
        }

        // Expose BonusModal to window for external control
        window.BonusModal = BonusModal;
    })();
    </script>

</body>

</html>